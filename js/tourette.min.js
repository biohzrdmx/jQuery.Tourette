/**
* jQuery Tourette
* @author biohzrdmx <github.com/biohzrdmx>
* @version 1.0
* @requires jQuery 1.8+
* @license MIT
*/
;(function($){$.Tourette=function(options){var tourette={tour:null,position:null,current:null,elements:null,templates:null,prevState:null,defaults:{overlayMarkup:'<div class="tourette-overlay"></div>',promptMarkup:'<div class="tourette-prompt"></div>',buttonMarkup:'<a href="#" class="tourette-button"></a>',onShow:function(landmark){},onHide:function(landmark){},onStart:function(landmark){},onExit:function(landmark){},onButton:function(landmark,action,button){}},callbacks:null,init:function(options){var obj=this,opts=$.extend(true,{},obj.defaults,options);obj.templates={overlay:opts.overlayMarkup,prompt:opts.promptMarkup,button:opts.buttonMarkup};obj.callbacks={onShow:opts.onShow,onHide:opts.onHide,onStart:opts.onStart,onExit:opts.onExit,onButton:opts.onButton};obj.elements={overlay:$(obj.templates.overlay)};obj.elements.overlay.hide();$('body').append(obj.elements.overlay);return obj},load:function(tour){var obj=this;obj.tour=tour||[];obj.position=0;obj.current=null},start:function(){var obj=this;obj.position=0;if(typeof obj.tour.landmarks[obj.position]!=='undefined'){obj.current=obj.tour.landmarks[obj.position];obj.callbacks.onStart(obj.current);obj.show()}else{}},next:function(){var obj=this;obj.position++;obj.position=obj.position>=obj.tour.landmarks.length?obj.tour.landmarks.length-1:obj.position;if(typeof obj.tour.landmarks[obj.position]!=='undefined'){obj.callbacks.onHide(obj.current);obj.current=obj.tour.landmarks[obj.position];obj.callbacks.onShow(obj.current);obj.show()}else{}},prev:function(){var obj=this;obj.position--;obj.position=obj.position<0?0:obj.position;if(typeof obj.tour.landmarks[obj.position]!=='undefined'){obj.callbacks.onHide(obj.current);obj.current=obj.tour.landmarks[obj.position];obj.callbacks.onShow(obj.current);obj.show()}else{}},show:function(){var obj=this;if(typeof obj.current!=='undefined'){if(!obj.elements.overlay.is(':visible')){obj.elements.overlay.fadeIn()}var createPrompt=function(){var prompt=$(obj.templates.prompt);obj.elements.prompt=prompt;obj.elements.prompt.append('<h1 class="tourette-title">'+obj.current.title+'</h1>');obj.elements.prompt.append('<div class="tourette-contents">'+obj.current.contents+'</div>');var actions=$('<div class="tourette-actions"></div>');for(var i=0;i<obj.current.actions.length;i++){(function(action){var button=$(obj.templates.button);button.text(action.text);if(action.cssClass){button.attr('class',action.cssClass)}button.on('click',function(e){e.preventDefault();switch(action.action){case'Tourette.next':obj.next();break;case'Tourette.prev':obj.prev();break;case'Tourette.show':obj.show();break;case'Tourette.hide':obj.hide();break;default:obj.callbacks.onButton(obj.current,action,button)}});actions.append(button)})(obj.current.actions[i])};obj.elements.prompt.append(actions);obj.elements.prompt.hide();$('body').append(obj.elements.prompt);var element=$(obj.current.element),promptWidth=prompt.outerWidth(),promptHeight=prompt.outerHeight();if(obj.current.element&&element.length){obj.moveToElement(element)}else{prompt.css({top:50,left:'50%',marginLeft:-(promptWidth/2)+'px'});$('html, body').animate({scrollTop:0},400,function(){obj.elements.prompt.fadeIn()})}}if(obj.elements.prompt){obj.elements.prompt.fadeOut(function(){$(this).remove();setTimeout(createPrompt,400)})}else{createPrompt()}}else{}},hide:function(){var obj=this;obj.callbacks.onHide(obj.current);obj.elements.prompt.fadeOut(function(){$(this).remove()});if(obj.prevState){obj.prevState.element.css({position:obj.prevState.styles.position,zIndex:obj.prevState.styles.zIndex});obj.prevState=null}obj.elements.overlay.fadeOut();$('html, body').animate({scrollTop:0},400);obj.callbacks.onExit(obj.current)},moveToElement:function(element){var obj=this,elementPos=element.offset(),elementWidth=element.outerWidth(),elementHeight=element.outerHeight(),viewWidth=$(window).width(),viewHeight=$(window).height(),prompt=obj.elements.prompt,promptWidth=prompt.outerWidth(),promptHeight=prompt.outerHeight(),scrollPos=0,promptPos={left:0,top:0};if(obj.prevState){console.log(obj.prevState);obj.prevState.element.css({position:obj.prevState.styles.position,zIndex:obj.prevState.styles.zIndex});obj.prevState=null}obj.prevState={element:element,styles:{position:element.css('position'),zIndex:element.css('zIndex')}}element.css({position:obj.prevState.styles.position=='absolute'?obj.prevState.styles.position:'relative',zIndex:2100});if(elementPos.top>promptHeight+15&&!obj.current.forceBelow){prompt.addClass('prompt-above');promptPos.top=elementPos.top-(promptHeight+15);scrollPos=promptPos.top-15}else{prompt.addClass('prompt-below');promptPos.top=elementPos.top+elementHeight+15;scrollPos=elementPos.top-15}promptPos.left=elementPos.left+((elementWidth/2)-(promptWidth/2));promptPos.left=promptPos.left<0?0:(promptPos.left+promptWidth>viewWidth?viewWidth-promptWidth:promptPos.left);prompt.css(promptPos);$('html, body').animate({scrollTop:scrollPos},400,function(){obj.elements.prompt.fadeIn()})}};return tourette.init(options)}})(jQuery);
